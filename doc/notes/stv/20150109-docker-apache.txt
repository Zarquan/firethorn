#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2014, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#  
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#


   # Stop any running apache service
   sudo service apache2 stop


  source "${HOME:?}/firethorn.settings"
    pushd "${FIRETHORN_CODE:?}"

        source "bin/util.sh"

	docker build  --tag firethorn/apache docker/apache
        docker run -p 80:80 --name firepache -d firethorn/apache 

    popd

    # Get Firethorn IP Addresss
    docker inspect --format '{{ .NetworkSettings.IPAddress }}' gillian
    > 172.17.0.165

   docker exec -it firepache bash

   nano /etc/apache2/apache2.conf

	...

	# mod_proxy setup.
	ProxyRequests Off
	ProxyPreserveHost On
	ProxyPass /atlas/tap http://172.17.0.165:8080/ retry=0
	ProxyPassReverse /atlas/tap http://172.17.0.155:8080/

	<Proxy *>
	    Order deny,allow
	    Allow from all
	</Proxy>

	<Location "/atlas/tap">
	  # Configurations specific to this location. Add what you need.
	  # For instance, you can add mod_proxy_html directives to fix
	  # links in the HTML code. See link at end of this page about using
	  # mod_proxy_html.

	  # Allow access to this proxied URL location for everyone.
	  Order allow,deny
	  Allow from all
	</Location>
	...


  sudo service apache2 reload

  exit 

  curl http://localhost/atlas/tap/firethorn/system/info

#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2014, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#  
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#

# (In test container)

# -----------------------------------------------------
# Install Java 

yum -y install java

# -----------------------------------------------------
# Download Stilts library
wget http://www.star.bris.ac.uk/~mbt/stilts/stilts.jar


java -jar stilts.jar taplint tapurl=http://peter:8080/firethorn/tap/19365889 debug=true truncate=120

This is STILTS taplint, 3.0-5/55558a7 (2015-10-22)
Static report types: ERROR(107), WARNING(37), INFO(16), SUMMARY(7), FAILURE(18)

Section TMV: Validate table metadata against XML schema
I-TMV-VURL-1 Validating http://peter:8080/firethorn/tap/19365889/tables as tableset (http://www.ivoa.net/xml/VODataSe...
E-TMV-ENFI-1 (l.14, c.14): cvc-complex-type.2.4.a: Invalid content was found starting with element 'schema'. One of '...
S-TMV-VALI-1 SAX report: warnings 0, errors 1, fatal 0

Section TME: Check content of tables metadata from /tables
I-TME-TURL-1 Reading table metadata from http://peter:8080/firethorn/tap/19365889/tables
E-TME-CRSV-1 Column name is ADQL reserved word 'size' in table columns - should delimit like '"size"'
S-TME-SUMM-1 Schemas: 2, Tables: 6, Columns: 207, Foreign Keys: 0
S-TME-FLGS-1 Standard column flags: indexed: 0, primary: 0, nullable: 0
S-TME-FLGO-1 Other column flags: none

Section TMS: Check content of tables metadata from TAP_SCHEMA
I-TMS-QSUB-1 Submitting query: SELECT COUNT(*) AS nr FROM TAP_SCHEMA.schemas
I-TMS-QGET-1 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+COUN...
I-TMS-QSUB-2 Submitting query: SELECT COUNT(*) AS nr FROM TAP_SCHEMA.tables
I-TMS-QGET-2 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+COUN...
I-TMS-QSUB-3 Submitting query: SELECT COUNT(*) AS nr FROM TAP_SCHEMA.columns
I-TMS-QGET-3 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+COUN...
I-TMS-QSUB-4 Submitting query: SELECT COUNT(*) AS nr FROM TAP_SCHEMA.keys
I-TMS-QGET-4 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+COUN...
I-TMS-QSUB-5 Submitting query: SELECT COUNT(*) AS nr FROM TAP_SCHEMA.key_columns
I-TMS-QGET-5 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+COUN...
I-TMS-QSUB-6 Submitting query: SELECT principal, indexed, std, "size" FROM TAP_SCHEMA.columns
I-TMS-QGET-6 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+prin...
I-TMS-QSUB-7 Submitting query: SELECT column_name, description, unit, ucd, utype, datatype, indexed, principal, std, ...
I-TMS-QGET-7 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+colu...
I-TMS-QSUB-8 Submitting query: SELECT from_column, target_column, key_id FROM TAP_SCHEMA.key_columns
I-TMS-QGET-8 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+from...
I-TMS-QSUB-9 Submitting query: SELECT key_id, target_table, description, utype, from_table FROM TAP_SCHEMA.keys
I-TMS-QGET-9 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+key_...
E-TMS-TNTN-1 Bad ADQL table name 'ATLASDR1.atlasSource                                                               ...
E-TMS-TNTN-2 Bad ADQL table name 'TAP_SCHEMA.columns                                                                 ...
E-TMS-TNTN-3 Bad ADQL table name 'TAP_SCHEMA.key_columns                                                             ...
E-TMS-TNTN-4 Bad ADQL table name 'TAP_SCHEMA.keys                                                                    ...
E-TMS-TNTN-5 Bad ADQL table name 'TAP_SCHEMA.schemas                                                                 ...
E-TMS-TNTN-6 Bad ADQL table name 'TAP_SCHEMA.tables                                                                  ...
E-TMS-CNID-1 Column name is not ADQL identifier 'aG                                                                  ...
E-TMS-CNID-2 Column name is not ADQL identifier 'aI                                                                  ...
E-TMS-CNID-3 Column name is not ADQL identifier 'aR                                                                  ...
E-TMS-CNID-4 Column name is not ADQL identifier 'aU                                                                  ...
E-TMS-CNID-5 Column name is not ADQL identifier 'aZ                                                                  ...
E-TMS-CNID-6 Column name is not ADQL identifier 'b                                                                   ...
E-TMS-CNID-7 Column name is not ADQL identifier 'cuEventID                                                           ...
E-TMS-CNID-8 Column name is not ADQL identifier 'cx                                                                  ...
E-TMS-CNID-9 Column name is not ADQL identifier 'cy                                                                  ...
S-TMS-SUMM-1 Schemas: 2, Tables: 6, Columns: 204, Foreign Keys: 0
S-TMS-FLGS-1 Standard column flags: indexed: 7, principal: 7, std: 27
S-TMS-QNUM-1 Successful/submitted TAP queries: 11/11
S-TMS-QTIM-1 Average successful query time: 29.0s
I-TMS-QSUB-x (2 more)
I-TMS-QGET-x (2 more)
E-TMS-CNID-x (195 more)

Section TMC: Compare table metadata from /tables and TAP_SCHEMA
E-TMC-SM12-1 Schema ATLASDR1 exists in /tables but not in TAP_SCHEMA
E-TMC-SM12-2 Schema TAP_SCHEMA exists in /tables but not in TAP_SCHEMA
E-TMC-SM21-1 Schema ATLASDR1                                                                                         ...
E-TMC-SM21-2 Schema TAP_SCHEMA                                                                                       ...

Section CPV: Validate capabilities against XML schema
I-CPV-VURL-1 Validating http://peter:8080/firethorn/tap/19365889/capabilities as capabilities (http://www.ivoa.net/xm...
E-CPV-EHAP-1 (l.1, c.2398): cvc-complex-type.2.4.b: The content of element 'capability' is not complete. One of '{lan...
S-CPV-VALI-1 SAX report: warnings 0, errors 1, fatal 0

Section CAP: Check content of TAPRegExt capabilities record
I-CAP-CURL-1 Reading capability metadata from http://peter:8080/firethorn/tap/19365889/capabilities
E-CAP-NOOF-1 No output formats defined

Section AVV: Validate availability against XML schema
I-AVV-VURL-1 Validating http://peter:8080/firethorn/tap/19365889/availability as availability (http://www.ivoa.net/xm...
S-AVV-VALI-1 SAX report: warnings 0, errors 0, fatal 0

Section QGE: Make ADQL queries in sync GET mode
I-QGE-QSUB-1 Submitting query: SELECT TOP 10 aG                                                                      ...
I-QGE-QGET-1 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+TOP+...
E-QGE-CNAM-1 Query/result column name mismatch for column #0; ag                                                     ...
E-QGE-QTYP-1 Query/result column type mismatch for column #0; FLOAT                                                  ...
I-QGE-QSUB-2 Submitting query: SELECT aG                                                                             ...
I-QGE-QGET-2 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+aG++...
E-QGE-NREC-1 More than MAXREC rows returned (1000 > 9) for SELECT aG                                                 ...
E-QGE-CNAM-2 Query/result column name mismatch for column #0; ag                                                     ...
E-QGE-QTYP-2 Query/result column type mismatch for column #0; FLOAT                                                  ...
E-QGE-OVNO-1 Overflow not marked - no <INFO name='QUERY_STATUS' value='OVERFLOW'/> after TABLE
I-QGE-QSUB-3 Submitting query: SELECT TOP 1 aG                                                                       ...
I-QGE-QGET-3 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL-2.0&QUERY=SELECT+...
I-QGE-QSUB-4 Submitting query: SELECT TOP 1 aG                                                                       ...
I-QGE-QGET-4 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+TOP+...
I-QGE-QSUB-5 Submitting query: SELECT TOP 8 zXi                                                                      ...
I-QGE-QGET-5 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+TOP+...
W-QGE-NOCT-1 No Content-Type header for http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY...
I-QGE-VVNL-1 Undeclared VOTable version; assuming v1.2
E-QGE-DQLD-1 (l.1, c.1): Premature end of file.
E-QGE-QERX-1 TAP query result parse failed [Premature end of file.]
org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 1; Premature end of file.
	at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1239)
	at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:643)
	at uk.ac.starlink.ttools.taplint.VotLintTapRunner.readResultDocument(VotLintTapRunner.java:267)
	at uk.ac.starlink.ttools.taplint.VotLintTapRunner.executeQuery(VotLintTapRunner.java:111)
	at uk.ac.starlink.ttools.taplint.TapRunner.attemptGetResultTable(TapRunner.java:78)
	at uk.ac.starlink.ttools.taplint.TapRunner.getResultTable(TapRunner.java:51)
	at uk.ac.starlink.ttools.taplint.QueryStage$Querier.runCheckedQuery(QueryStage.java:452)
	at uk.ac.starlink.ttools.taplint.QueryStage$Querier.runSomeColumns(QueryStage.java:412)
	at uk.ac.starlink.ttools.taplint.QueryStage$Querier.run(QueryStage.java:266)
	at uk.ac.starlink.ttools.taplint.QueryStage.run(QueryStage.java:99)
	at uk.ac.starlink.ttools.taplint.TapLinter$1.execute(TapLinter.java:203)
	at uk.ac.starlink.ttools.task.LineInvoker.invoke(LineInvoker.java:294)
	at uk.ac.starlink.ttools.Stilts.main(Stilts.java:43)
I-QGE-QSUB-6 Submitting query: SELECT aG                                                                             ...
I-QGE-QGET-6 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=SELECT+aG++...
E-QGE-NREC-2 More than MAXREC rows returned (1000 > 0) for SELECT aG                                                 ...
E-QGE-CNAM-3 Query/result column name mismatch for column #0; ag                                                     ...
E-QGE-QTYP-3 Query/result column type mismatch for column #0; FLOAT                                                  ...
I-QGE-DUFF-1 Submitting duff query: DUFF QUERY
I-QGE-QGET-7 Query GET URL: http://peter:8080/firethorn/tap/19365889/sync?REQUEST=doQuery&LANG=ADQL&QUERY=DUFF+QUERY
S-QGE-QNUM-1 Successful/submitted TAP queries: 5/6
S-QGE-QTIM-1 Average successful query time: 30.9s

Section QPO: Make ADQL queries in sync POST mode
I-QPO-QSUB-1 Submitting query: SELECT TOP 10 aG                                                                      ...
E-QPO-CNAM-1 Query/result column name mismatch for column #0; ag                                                     ...
E-QPO-QTYP-1 Query/result column type mismatch for column #0; FLOAT                                                  ...
I-QPO-QSUB-2 Submitting query: SELECT aG                                                                             ...
E-QPO-NREC-1 More than MAXREC rows returned (1000 > 9) for SELECT aG                                                 ...
E-QPO-CNAM-2 Query/result column name mismatch for column #0; ag                                                     ...
E-QPO-QTYP-2 Query/result column type mismatch for column #0; FLOAT                                                  ...
E-QPO-OVNO-1 Overflow not marked - no <INFO name='QUERY_STATUS' value='OVERFLOW'/> after TABLE
I-QPO-QSUB-3 Submitting query: SELECT TOP 8 zXi                                                                      ...
E-QPO-CNAM-3 Query/result column name mismatch for column #0; zxi                                                    ...
E-QPO-QTYP-3 Query/result column type mismatch for column #0; FLOAT                                                  ...
E-QPO-QTYP-4 Query/result column type mismatch for column taplint_c_2; SHORT                                         ...
E-QPO-CNAM-4 Query/result column name mismatch for column #2; upsfmag                                                ...
E-QPO-QTYP-5 Query/result column type mismatch for column #2; FLOAT                                                  ...
E-QPO-QTYP-6 Query/result column type mismatch for column taplint_c_4; FLOAT                                         ...
E-QPO-CNAM-5 Query/result column name mismatch for column #4; rpsfmag                                                ...
E-QPO-QTYP-7 Query/result column type mismatch for column #4; FLOAT                                                  ...
E-QPO-QTYP-8 Query/result column type mismatch for column taplint_c_6; FLOAT                                         ...
E-QPO-CNAM-6 Query/result column name mismatch for column #6; mergedclassstat                                        ...
E-QPO-QTYP-9 Query/result column type mismatch for column #6; FLOAT                                                  ...
E-QPO-CNAM-7 Query/result column name mismatch for column #8; iapermag4                                              ...
E-QPO-CNAM-8 Query/result column name mismatch for column #10; gapermag4                                             ...
I-QPO-QSUB-4 Submitting query: SELECT aG                                                                             ...
E-QPO-NREC-2 More than MAXREC rows returned (1000 > 0) for SELECT aG                                                 ...
E-QPO-CNAM-9 Query/result column name mismatch for column #0; ag                                                     ...
I-QPO-DUFF-1 Submitting duff query: DUFF QUERY
S-QPO-QNUM-1 Successful/submitted TAP queries: 4/4
S-QPO-QTIM-1 Average successful query time: 35.5s
E-QPO-QTYP-x (6 more)

Section QAS: Make ADQL queries in async mode
I-QAS-QSUB-1 Submitting query: SELECT TOP 10 aG                                                                      ...
I-QAS-QJOB-1 Submitted query at http://peter:8080/firethorn/tap/19365889/async/19496983
E-QAS-CNAM-1 Query/result column name mismatch for column #0; ag                                                     ...
E-QAS-QTYP-1 Query/result column type mismatch for column #0; FLOAT                                                  ...
I-QAS-QSUB-2 Submitting query: SELECT aG                                                                             ...
I-QAS-QJOB-2 Submitted query at http://peter:8080/firethorn/tap/19365889/async/19496984
E-QAS-NREC-1 More than MAXREC rows returned (1000 > 9) for SELECT aG                                                 ...
E-QAS-CNAM-2 Query/result column name mismatch for column #0; ag                                                     ...
E-QAS-QTYP-2 Query/result column type mismatch for column #0; FLOAT                                                  ...
E-QAS-OVNO-1 Overflow not marked - no <INFO name='QUERY_STATUS' value='OVERFLOW'/> after TABLE
I-QAS-QSUB-3 Submitting query: SELECT TOP 8 zXi                                                                      ...
I-QAS-QJOB-3 Submitted query at http://peter:8080/firethorn/tap/19365889/async/19496985
E-QAS-CNAM-3 Query/result column name mismatch for column #0; zxi                                                    ...
E-QAS-QTYP-3 Query/result column type mismatch for column #0; FLOAT                                                  ...
E-QAS-QTYP-4 Query/result column type mismatch for column taplint_c_2; SHORT                                         ...
E-QAS-CNAM-4 Query/result column name mismatch for column #2; upsfmag                                                ...
E-QAS-QTYP-5 Query/result column type mismatch for column #2; FLOAT                                                  ...
E-QAS-QTYP-6 Query/result column type mismatch for column taplint_c_4; FLOAT                                         ...
E-QAS-CNAM-5 Query/result column name mismatch for column #4; rpsfmag                                                ...
E-QAS-QTYP-7 Query/result column type mismatch for column #4; FLOAT                                                  ...
E-QAS-QTYP-8 Query/result column type mismatch for column taplint_c_6; FLOAT                                         ...
E-QAS-CNAM-6 Query/result column name mismatch for column #6; mergedclassstat                                        ...
E-QAS-QTYP-9 Query/result column type mismatch for column #6; FLOAT                                                  ...
E-QAS-CNAM-7 Query/result column name mismatch for column #8; iapermag4                                              ...
E-QAS-CNAM-8 Query/result column name mismatch for column #10; gapermag4                                             ...
I-QAS-QSUB-4 Submitting query: SELECT aG                                                                             ...
I-QAS-QJOB-4 Submitted query at http://peter:8080/firethorn/tap/19365889/async/19496986
E-QAS-NREC-2 More than MAXREC rows returned (1000 > 0) for SELECT aG                                                 ...
E-QAS-CNAM-9 Query/result column name mismatch for column #0; ag                                                     ...
I-QAS-DUFF-1 Submitting duff query: DUFF QUERY
I-QAS-QJOB-5 Submitted query at http://peter:8080/firethorn/tap/19365889/async/19496987
S-QAS-QNUM-1 Successful/submitted TAP queries: 4/4
S-QAS-QTIM-1 Average successful query time: 45.9s
E-QAS-QTYP-x (6 more)

Section UWS: Test asynchronous UWS/TAP behaviour
I-UWS-CJOB-1 Created new job http://peter:8080/firethorn/tap/19365889/async/19496988
I-UWS-POPA-1 POSTed runId=TAPLINT-002 to http://peter:8080/firethorn/tap/19365889/async/19496988/parameters
I-UWS-POPA-2 POSTed PHASE=ABORT to http://peter:8080/firethorn/tap/19365889/async/19496988/phase
E-UWS-PORE-1 Error response 405 Method Not Allowed for POST ACTION=DELETE to http://peter:8080/firethorn/tap/19365889...
I-UWS-CJOB-2 Created new job http://peter:8080/firethorn/tap/19365889/async/19496989
E-UWS-DENO-1 Deleted job gives HTTP response 200 not 404 for http://peter:8080/firethorn/tap/19365889/async/19496989
I-UWS-CJOB-3 Created new job http://peter:8080/firethorn/tap/19365889/async/19496990
W-UWS-TFMT-1 Not ISO-8601 content "0" from http://peter:8080/firethorn/tap/19365889/async/19496990/destruction
I-UWS-POPA-3 POSTed PHASE=RUN to http://peter:8080/firethorn/tap/19365889/async/19496990/phase

Section MDQ: Check table query result columns against declared metadata
I-MDQ-QSUB-1 Submitting query: SELECT TOP 1 * FROM ATLASDR1.atlasSource
E-MDQ-CLDR-1 SELECT * for table ATLASDR1.atlasSource                                                                 ...
E-MDQ-CLRD-1 SELECT * for table ATLASDR1.atlasSource                                                                 ...
I-MDQ-QSUB-2 Submitting query: SELECT TOP 1 * FROM TAP_SCHEMA.columns
E-MDQ-CLDR-2 SELECT * for table TAP_SCHEMA.columns                                                                   ...
E-MDQ-CLRD-2 SELECT * for table TAP_SCHEMA.columns                                                                   ...
I-MDQ-QSUB-3 Submitting query: SELECT TOP 1 * FROM TAP_SCHEMA.key_columns
E-MDQ-CLDR-3 SELECT * for table TAP_SCHEMA.key_columns                                                               ...
E-MDQ-CLRD-3 SELECT * for table TAP_SCHEMA.key_columns                                                               ...
I-MDQ-QSUB-4 Submitting query: SELECT TOP 1 * FROM TAP_SCHEMA.keys
E-MDQ-CLDR-4 SELECT * for table TAP_SCHEMA.keys                                                                      ...
E-MDQ-CLRD-4 SELECT * for table TAP_SCHEMA.keys                                                                      ...
I-MDQ-QSUB-5 Submitting query: SELECT TOP 1 * FROM TAP_SCHEMA.schemas
E-MDQ-CLDR-5 SELECT * for table TAP_SCHEMA.schemas                                                                   ...
E-MDQ-CLRD-5 SELECT * for table TAP_SCHEMA.schemas                                                                   ...
I-MDQ-QSUB-6 Submitting query: SELECT TOP 1 * FROM TAP_SCHEMA.tables
E-MDQ-CLDR-6 SELECT * for table TAP_SCHEMA.tables                                                                    ...
E-MDQ-CLRD-6 SELECT * for table TAP_SCHEMA.tables                                                                    ...
S-MDQ-QNUM-1 Successful/submitted TAP queries: 6/6
S-MDQ-QTIM-1 Average successful query time: 31.9s

Section OBS: Test implementation of ObsCore Data Model
I-OBS-NODM-1 Table capabilities lists no DataModel ivo://ivoa.net/std/ObsCore/v1.0 - no ObsCore tests

Section UPL: Make queries with table uploads
F-UPL-NOUP-1 Table capabilities lists no upload methods - will not attempt upload tests

Totals: Errors: 297; Warnings: 2; Infos: 70; Summaries: 18; Failures: 1


